<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      canvas {
        position: fixed;
        top: 100px;
        left: 0;
      }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>

    <title>MyCountdown</title>
  </head>
  <body
    onmousemove="moveImage(event)"
    class="bg-gradient-to-r from-cyan-400 to-fuchsia-500"
  >
    <!-- The container of buttons -->
    <div class="flex justify-between text-center pt-10">
      <div
        class="w-[30rem] ms-10 shadow-xl border-8 flex h-[5rem] relative"
        id="imageContainer"
      >
        <!-- images-1 -->
        <div class="flex justify-center ps-2">
          <img
            class=""
            onclick=""
            src="./images/face-holding-back-tears_1f979.png"
            alt=""
            draggable="false"
          />
          <img
            class=""
            onclick=""
            src="./images/face-with-open-eyes-and-hand-over-mouth_1fae2.png"
            alt=""
          />
          <img
            class=""
            onclick=""
            src="./images/face-with-thermometer_1f912.png"
            alt=""
          />
          <img class="" onclick="" src="./images/angry-face_1f620.png" alt="" />
          <img
            class=""
            onclick=""
            src="./images/face-with-spiral-eyes_1f635-200d-1f4ab.png"
            alt=""
          />
          <img
            class=""
            onclick=""
            src="./images/smiling-face-with-hearts_1f970.png"
            alt=""
          />
          <img
            class=""
            onclick=""
            src="./images/smiling-face-with-sunglasses_1f60e.png"
            alt=""
          />
        </div>
      </div>
      <div class="flex mr-10">
        <div class="pr-3">
          <button
            onclick="fetchRandomQuote()"
            class="px-4 py-2 bg-blue-500 text-white font-bold rounded-md shadow-md"
          >
            Quotation
          </button>
        </div>
        <div class="pr-3">
          <button
            onclick="removeChildElement()"
            class="px-4 py-2 bg-blue-500 text-white font-bold rounded-md shadow-md"
          >
            STOP CONFETTI
          </button>
        </div>
        <div class="pr-3 flex flex-col">
          <div>
            <button
              onclick="setTime()"
              class="px-4 py-2 bg-blue-500 text-white font-bold rounded-md shadow-md"
            >
              ALARM
            </button>
          </div>

          <div id="settim" class="mt-6 hidden">
            <input type="datetime-local" id="eventDateInput" />
            <div>
              <button
                class="px-4 mt-5 py-2 bg-blue-500 text-white font-bold rounded-md shadow-md"
                onclick="startCountdown()"
              >
                start countdown
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- This div contain div of images and div of coutdown -->
    <div class="flex justify-center text-center items-center">
      <!-- images container -->

      <!-- Countdown -->

      <div
        id="countdown"
        class="flex justify-center shadow-xl mt-40 mr-20 items-center text-center bg-transparent border-8 h-[200px] text-white text-[3rem] w-[60%]"
      ></div>
    </div>
    <!-- <div
      id="popup"
      class="w-20 h-24 bg-cyan-400 rounded-md absolute top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] text-center pt-0 pb-[30%] px-[30%]text-white text-3xl"
    >
      <h2
        id="popH"
        class="font-sans text-3xl font-bold text-white mt-8 mb-0 mx-10"
      ></h2>

      <button
        class="px-4 py-2 bg-blue-500 text-white font-bold rounded-md shadow-md"
      >
        Thanks
      </button>
    </div> -->
    <div
      id="popup"
      class="fixed invisible inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75"
    >
      <div class="bg-white rounded-lg p-8">
        <img
          class="w-14 mt-[-50px]"
          src="./images/smiling-face-with-sunglasses_1f60e.png"
          alt=""
        />
        <h2 id="popH" class="text-2xl font-bold mb-4">Popup Content</h2>

        <button
          onclick="removePopup()"
          class="mt-4 px-4 py-2 bg-blue-500 text-white font-bold rounded-md shadow-md"
        >
          Close
        </button>
      </div>
    </div>
    <script>
      //declar drag variable outside the function
      let drag = false;
      //Add attributes to any image in Dom automatic
      function addDraggableAttributeToImages() {
        const images = document.querySelectorAll("img");
        images.forEach((image) => {
          image.setAttribute("draggable", "false");
          image.setAttribute("onmousedown", "");
          //   image.setAttribute('onmouseup', 'drag=false');
          //     image.id = `image${index + 1}`; // Assign unique id dynamically
          // image.style.position = 'static'; // Set initial position to static
          // image.style.left = '0';
          // image.style.top = '0';
          // image.addEventListener("mousedown", function () {
          //   // Set position to absolute when clicked
          //   image.style.position = "absolute";
          //   image.style.width = "";
          // });
          //   image.addEventListener('mouseup', function () {
          //     // Set position to static when mouseup
          //     image.style.position = 'static';
          // });
        });
      }
      //call addDraggableAttributeToImages when Dom loading
      document.addEventListener("DOMContentLoaded", function () {
        addDraggableAttributeToImages();
      });
      //set function to move the image depended on the mouse moving

      let moveImage = function (event) {
        const imageContainer = document.getElementById("imageContainer");
        const images = imageContainer.querySelectorAll("img");
        images.forEach((image) => {
          if (drag && image.style.position === "absolute") {
            image.style.left = event.clientX + "px";
            image.style.top = event.clientY + "px";
          }
        });
      };
      //The section for countdown
      // Get the target event date
      // let eventDate = new Date("2023-06-15T11:34:00Z");

      //declar the count variable outside the function
      let count;
      // Get the countdown element
      const countdownElement = document.getElementById("countdown");

      // Function to start the countdown
      function startCountdown() {
        // Get the target event date from the input field
        const eventDateInput = document.getElementById("eventDateInput").value;
        const eventDate = new Date(eventDateInput);

        // Validate the input date
        if (isNaN(eventDate.getTime())) {
          countdownElement.innerHTML = "Invalid date";
          return;
        }

        // Clear any existing countdown

        //function to update the countdown timer
        function updateCountDown() {
          let currentDate = new Date();
          let differenceTime = eventDate - currentDate;
          //Clear the time out ane dissplay a message
          if (differenceTime <= 0) {
            clearTimeout(count);
            document.getElementById("countdown").innerHTML =
              "Congratulations, you have achieved your goal :)";
            //call celebrate function here to run when reach the goal

            celebrateGoal();
            return;
          }
          //Add if statement to stop celebrateGoal function

          //Calculate remaining days,hours,hours,minutes and seconds
          let day = Math.floor(differenceTime / (24 * 60 * 60 * 1000));
          let hours = Math.floor(
            (differenceTime % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000)
          );
          let minutes = Math.floor(
            (differenceTime % (60 * 60 * 1000)) / (60 * 1000)
          );
          let seconds = Math.floor((differenceTime % (60 * 1000)) / 1000);
          //Update the count down element
          document.getElementById(
            "countdown"
          ).innerHTML = `days ${day}: hours ${hours}: minutes ${minutes}: seconds ${seconds}`;
          //Update the countdown every second
          count = setTimeout(updateCountDown, 1000);
          //call the function to start the counter
        }

        updateCountDown();
      }
      // There was one issue in this code and I fixed it the issue was I had to declar the count outside function not inside the function.
      //celebration function
      function celebrateGoal() {
        // Create a canvas element
        var canvas = document.createElement("canvas");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        document.body.appendChild(canvas);
        canvas.setAttribute("id", "canvasId");
        // Get the canvas context
        var context = canvas.getContext("2d");

        // Generate random confetti particles
        var confettiParticles = [];
        for (var i = 0; i < 100; i++) {
          confettiParticles.push(
            createConfettiParticle(canvas.width, canvas.height)
          );
        }

        // Animation loop
        function animateConfetti() {
          // Clear the canvas
          context.clearRect(0, 0, canvas.width, canvas.height);

          // Update and draw confetti particles
          for (var i = 0; i < confettiParticles.length; i++) {
            var particle = confettiParticles[i];
            particle.y += particle.speed;

            // Rotate the confetti particle
            particle.rotation += particle.rotationSpeed;

            // Draw the confetti particle
            context.save();
            context.translate(particle.x, particle.y);
            context.rotate(particle.rotation);
            context.fillStyle = particle.color;
            context.fillRect(
              -particle.size / 2,
              -particle.size / 2,
              particle.size,
              particle.size
            );
            context.restore();

            // Reset the confetti particle if it goes off-screen
            if (particle.y > canvas.height) {
              confettiParticles[i] = createConfettiParticle(
                canvas.width,
                canvas.height
              );
            }
          }

          // Repeat the animation loop
          requestAnimationFrame(animateConfetti);
        }

        // Start the animation loop
        animateConfetti();
      }

      // Function to create a confetti particle
      function createConfettiParticle(canvasWidth, canvasHeight) {
        var colors = ["#ff4081", "#3f51b5", "#00bcd4", "#8bc34a", "#ffc107"];
        var color = colors[Math.floor(Math.random() * colors.length)];
        var size = Math.random() * 10 + 5;
        var x = Math.random() * canvasWidth;
        var y = -size;
        var speed = Math.random() * 3 + 2;
        var rotationSpeed = Math.random() * 0.1 + 0.05;
        var rotation = Math.random() * 360;
        return { color, size, x, y, speed, rotationSpeed, rotation };
      }
      //Function to stop the confetti animation
      function removeChildElement() {
        var parentElement = document.body;
        var childElement = document.getElementById("canvasId");
        console.log(parentElement);
        // Remove the child element from its parent
        parentElement.removeChild(childElement);
      }

      async function fetchRandomQuote() {
        try {
          const response = await fetch("https://api.quotable.io/random"); // Replace with the actual API URL
          const data = await response.json();

          const quotes = data.quotes; // Assuming the API response contains an array of quotes

          // put qoutes in popup div
          document.getElementById("popH");
          document.getElementById("popup");
          popup.style.visibility = "visible";
          popH.innerHTML = data.content;
        } catch (error) {
          console.error("Error:", error);
        }
      }
      function removePopup() {
        document.getElementById("popup");
        popup.style.visibility = "hidden";
      }
      //make input and button visible to set time
      function setTime() {
        document.getElementById("set-time");

        settim.style.display = "inline-block";
      }
    </script>
  </body>
</html>
